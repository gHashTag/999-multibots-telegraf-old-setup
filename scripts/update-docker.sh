#!/bin/bash

# ===== üåà –°–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è NeuroBlogger üåà =====
# –ê–≤—Ç–æ—Ä: NeuroBlogger AI
# –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: 18.04.2025
# –í–µ—Ä—Å–∏—è: 1.1

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ —Å —ç–º–æ–¥–∑–∏
echo_emoji() {
    echo -e "${2}$1${NC}"
}

# –ó–∞–≥–æ–ª–æ–≤–æ–∫
echo_emoji "üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è NeuroBlogger..." "${BLUE}"
echo_emoji "=====================================================" "${BLUE}"

# –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–ø—É—â–µ–Ω –ª–∏ —Å–∫—Ä–∏–ø—Ç –æ—Ç –∏–º–µ–Ω–∏ root
if [ "$(id -u)" != "0" ]; then
    echo_emoji "‚ùå –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω —Å –ø—Ä–∞–≤–∞–º–∏ root." "${RED}"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
echo_emoji "üìÇ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞..." "${YELLOW}"
if [ ! -d "/opt/app/999-multibots-telegraf" ]; then
    echo_emoji "‚ùå –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!" "${RED}"
    exit 1
fi

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
echo_emoji "üîÑ –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞..." "${YELLOW}"
cd /opt/app/999-multibots-telegraf || exit

# –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π —Ö—ç—à –∫–æ–º–º–∏—Ç–∞
echo_emoji "üìå –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è..." "${YELLOW}"
CURRENT_COMMIT=$(git rev-parse HEAD)
echo_emoji "   –¢–µ–∫—É—â–∏–π –∫–æ–º–º–∏—Ç: ${CURRENT_COMMIT}" "${CYAN}"

# –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
echo_emoji "‚¨áÔ∏è –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è..." "${YELLOW}"
git fetch
if [ $? -ne 0 ]; then
    echo_emoji "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ git fetch. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ." "${RED}"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
echo_emoji "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–æ–≤—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π..." "${YELLOW}"
UPSTREAM=${1:-'@{u}'}
LOCAL=$(git rev-parse @)
REMOTE=$(git rev-parse "$UPSTREAM")

if [ "$LOCAL" = "$REMOTE" ]; then
    echo_emoji "‚úÖ –°–∏—Å—Ç–µ–º–∞ —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏." "${GREEN}"
    echo_emoji "   –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: $(git describe --tags --always)" "${CYAN}"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
    echo_emoji "üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..." "${YELLOW}"
    if [ "$(docker ps -q -f name=999-multibots)" ]; then
        echo_emoji "‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —É–∂–µ –∑–∞–ø—É—â–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç." "${GREEN}"
        
        # –°–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Ö–æ—á–µ—Ç –ª–∏ –æ–Ω –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
        echo_emoji "‚ùì –•–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã? (y/n)" "${PURPLE}"
        read -r restart_anyway
        
        if [ "$restart_anyway" = "y" ] || [ "$restart_anyway" = "Y" ]; then
            echo_emoji "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..." "${YELLOW}"
        else
            echo_emoji "‚úÖ –°–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à–∏–ª —Ä–∞–±–æ—Ç—É –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤." "${GREEN}"
            exit 0
        fi
    else
        echo_emoji "‚ö†Ô∏è –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –∑–∞–ø—É—â–µ–Ω—ã. –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..." "${YELLOW}"
    fi
else
    # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    echo_emoji "‚¨áÔ∏è –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π..." "${YELLOW}"
    git pull
    if [ $? -ne 0 ]; then
        echo_emoji "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ git pull. –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é." "${RED}"
        git reset --hard "$CURRENT_COMMIT"
        exit 1
    fi
    
    echo_emoji "‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ!" "${GREEN}"
    echo_emoji "   –ü—Ä–µ–¥—ã–¥—É—â–∞—è –≤–µ—Ä—Å–∏—è: ${CURRENT_COMMIT}" "${CYAN}"
    echo_emoji "   –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è: $(git rev-parse HEAD)" "${CYAN}"
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
    echo_emoji "üîë –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –Ω–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è —Å–∫—Ä–∏–ø—Ç–æ–≤..." "${YELLOW}"
    chmod +x *.sh scripts/*.sh 2>/dev/null
    echo_emoji "‚úÖ –ü—Ä–∞–≤–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!" "${GREEN}"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Docker –∏ Nginx
echo_emoji "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Docker –∏ Nginx..." "${YELLOW}"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∑–∞–ø–∏—Å–∏ app –≤ /etc/hosts —Å–∏—Å—Ç–µ–º—ã –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
if ! grep -q "app" /etc/hosts; then
    echo_emoji "‚ö†Ô∏è –í /etc/hosts –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–ø–∏—Å—å –¥–ª—è 'app'. –î–æ–±–∞–≤–ª—è–µ–º..." "${YELLOW}"
    echo "172.20.0.2 app" >> /etc/hosts
    echo_emoji "‚úÖ –ó–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞!" "${GREEN}"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–∏—Å—å –≤ hosts –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ nginx-proxy
if docker ps -q -f name=nginx-proxy >/dev/null; then
    if ! docker exec nginx-proxy grep -q "app" /etc/hosts; then
        echo_emoji "‚ö†Ô∏è –í /etc/hosts –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ nginx-proxy –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–ø–∏—Å—å –¥–ª—è 'app'. –î–æ–±–∞–≤–ª—è–µ–º..." "${YELLOW}"
        docker exec nginx-proxy sh -c 'echo "172.20.0.2 app" >> /etc/hosts'
        echo_emoji "‚úÖ –ó–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞!" "${GREEN}"
    else
        echo_emoji "‚úÖ –ó–∞–ø–∏—Å—å 'app' –≤ /etc/hosts –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ nginx-proxy —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç." "${GREEN}"
    fi
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –ª–æ–∫–∞—Ü–∏–π –≤ Nginx
echo_emoji "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã..." "${YELLOW}"
DUPES=$(grep -r "location" /etc/nginx/conf.d/ | sort | uniq -d)
if [ -n "$DUPES" ]; then
    echo_emoji "‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –ª–æ–∫–∞—Ü–∏–∏:" "${RED}"
    echo "$DUPES"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ —Å Gaia_Kamskaia_bot
    GAIA_CONFLICT=$(grep -r "Gaia_Kamskaia_bot" /etc/nginx/conf.d/)
    if [[ $(echo "$GAIA_CONFLICT" | wc -l) -gt 1 ]]; then
        echo_emoji "üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç –¥–ª—è –±–æ—Ç–∞ Gaia_Kamskaia_bot!" "${YELLOW}"
        echo "$GAIA_CONFLICT"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ bot3.locations
        if grep -q "Gaia_Kamskaia_bot" /etc/nginx/conf.d/bot3.locations; then
            echo_emoji "üîÑ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞: –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏ –≤ bot3.locations..." "${YELLOW}"
            sed -i 's/Gaia_Kamskaia_bot/ZavaraBot/g' /etc/nginx/conf.d/bot3.locations
            echo_emoji "‚úÖ –õ–æ–∫–∞—Ü–∏—è –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∞ –≤ ZavaraBot!" "${GREEN}"
            
            # –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx
            if docker exec nginx-proxy nginx -s reload >/dev/null 2>&1; then
                echo_emoji "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω–∞." "${GREEN}"
            else
                echo_emoji "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx." "${RED}"
            fi
        else
            echo_emoji "‚ö†Ô∏è –§–∞–π–ª bot3.locations –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏–π Gaia_Kamskaia_bot." "${YELLOW}"
        fi
    else
        echo_emoji "‚úÖ –ö–æ–Ω—Ñ–ª–∏–∫—Ç–∞ —Å Gaia_Kamskaia_bot –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ." "${GREEN}"
    fi
    
    echo_emoji "üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—Ä—É–≥–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –ª–æ–∫–∞—Ü–∏–∏..." "${YELLOW}"
else
    echo_emoji "‚úÖ –î—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –ª–æ–∫–∞—Ü–∏–π –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ." "${GREEN}"
fi

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx
echo_emoji "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx..." "${YELLOW}"
if docker exec nginx-proxy nginx -t >/dev/null 2>&1; then
    echo_emoji "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞." "${GREEN}"
else
    echo_emoji "‚ö†Ô∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–∫–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤—Ä—É—á–Ω—É—é." "${RED}"
fi

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
echo_emoji "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..." "${YELLOW}"
docker-compose down
if [ $? -ne 0 ]; then
    echo_emoji "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤. –ü—Ä–æ–±—É–µ–º docker compose down..." "${RED}"
    docker compose down
    if [ $? -ne 0 ]; then
        echo_emoji "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ä—É—á–Ω—É—é." "${RED}"
        exit 1
    fi
fi
echo_emoji "‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!" "${GREEN}"

# –û—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
echo_emoji "üßπ –û—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö Docker —Ä–µ—Å—É—Ä—Å–æ–≤..." "${YELLOW}"
docker system prune -f --volumes
echo_emoji "‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!" "${GREEN}"

# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
echo_emoji "üèóÔ∏è –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..." "${YELLOW}"
docker-compose up --build -d
if [ $? -ne 0 ]; then
    echo_emoji "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ docker-compose. –ü—Ä–æ–±—É–µ–º docker compose..." "${RED}"
    docker compose up --build -d
    if [ $? -ne 0 ]; then
        echo_emoji "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Docker." "${RED}"
        exit 1
    fi
fi
echo_emoji "‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω—ã –∏ –∑–∞–ø—É—â–µ–Ω—ã!" "${GREEN}"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
echo_emoji "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..." "${YELLOW}"
sleep 5  # –î–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º –≤—Ä–µ–º—è –Ω–∞ –∑–∞–ø—É—Å–∫

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
if docker ps -q -f name=999-multibots >/dev/null && docker ps -q -f name=nginx-proxy >/dev/null; then
    echo_emoji "‚úÖ –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç!" "${GREEN}"
else
    echo_emoji "‚ö†Ô∏è –ù–µ –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –≤—Ä—É—á–Ω—É—é:" "${RED}"
    docker ps
fi

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Nginx –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
echo_emoji "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Nginx –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ..." "${YELLOW}"
docker exec nginx-proxy nginx -s reload 2>/dev/null || docker exec nginx-proxy service nginx restart
echo_emoji "‚úÖ Nginx –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω!" "${GREEN}"

# –í—ã–≤–æ–¥ –ª–æ–≥–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
echo_emoji "üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:" "${PURPLE}"
echo_emoji "===== 999-multibots =====" "${BLUE}"
docker logs --tail 10 999-multibots
echo_emoji "===== nginx-proxy =====" "${BLUE}"
docker logs --tail 10 nginx-proxy

# –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
echo_emoji "=====================================================" "${BLUE}"
echo_emoji "‚ú® –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ NeuroBlogger —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!" "${GREEN}"
echo_emoji "üåê –°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ –≤–µ—Ä—Å–∏–∏: $(git describe --tags --always 2>/dev/null || git rev-parse --short HEAD)" "${CYAN}"
echo_emoji "üïí –í—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: $(date)" "${CYAN}"
echo_emoji "=====================================================" "${BLUE}"

exit 0
